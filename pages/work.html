<link rel="stylesheet" href="pages/work.css" />

<h2><i class="icon-work"></i>Works</h2>
<p>
    私たちが制作したゲームやその他の作品です。<br />
    <small>（製作者のニックネームは開発当時のものであり、現在と異なる可能性があります） </small>
    <br />
    <br />
    ゲームのダウンロード方法は
    <a href="#help">こちら</a>。
</p>

<div id="works">
    <h3>Games</h3>
    <div id="games">
        <!-- ここにゲームが入る -->
    </div>

    <!-- その他は今のところ手動追加 -->
    <h3>Other</h3>
    <div id="other">
        <button class="imageFrame" onclick="openWebPageModal()">
            <img src="image/games/mcrwebpage.png" alt="webpage" />
        </button>
    </div>
</div>

<!-- モーダルウィンドウ -->
<div id="modal" style="display: none">
    <div id="modal-content"></div>
</div>

<script>
    // ゲーム専用
    function openGameModal(i) {
        const gamedata = games[i]

        openModal(
            `
            <h3>${gamedata.title}</h3>
            <div class="game-description">
                <div class="imageFrame2">
                    <img src="${gamedata.imagePath}" alt="${gamedata.title}">
                </div>
                <div class="game-text">
                    制作者: ${gamedata.author}<br />
                    制作年: ${gamedata.year}<br />
                    <br />
                    <a href="${gamedata.gamePath}" target="_blank" class="download-button">
                    あそぶ!
                    </a><br /><br />
                    ${gamedata.description}
                </div>
            </div>
            `,
        )
    }

    // モーダルウィンドウを開く
    function openModal(html) {
        const modal = document.getElementById("modal")
        const modalContent = document.getElementById("modal-content")

        modalContent.innerHTML =
            `
                <span class="close">&times;</span>
            ` + html

        modal.style.display = "flex" // モーダルを表示

        const closeModalBtn = document.querySelector(".close")
        // モーダルを閉じる
        closeModalBtn.addEventListener("click", () => {
            modal.style.display = "none" // モーダルを非表示
        })
    }

    // まじでvarを使う時が来るとは思わなかったにゃ...
    // ページが読み込まれるたびに再宣言されるせい
    // 何とかしないとにゃー
    var games

    // ゲームを自動追加
    async function setModal(params) {
        const response = await fetch("gamedata.json")
        games = await response.json()

        games.forEach((gamedata, i) => {
            document.getElementById("games").innerHTML += `
                <button class="imageFrame" onclick="openGameModal(${i})">
                    <img src="${gamedata.imagePath}" alt="${gamedata.title}">
                </button>
            `
        })

        const modal = document.getElementById("modal")
        modal.style.display = "none"

        // モーダルの外側をクリックしても閉じる
        window.addEventListener("click", (event) => {
            if (event.target === modal) {
                modal.style.display = "none"
            }
        })
    }

    setModal()

    // otherのmodal専用の関数
    // 流石に何とか抽象化しないとだにゃー
    function openWebPageModal() {
        openModal(`
            <h3>MCR Home Page</h3>
            <div class="game-description">
                <div class="imageFrame2">
                    <img src="image/games/mcrwebpage.png" alt="webpage">
                </div>
                <div class="game-text">
                    制作者: sakana<br />
                    制作年: 2013<br />
                    <br />
                    <p>多分5年ぶりの更新</p>
                    <p>疲れたにゃー</p>
                    <p>
                        度々増築したり、イベントに合わせて特別バージョンになったりしてたみたいだにゃー<br />
                        頑張ってみるかにゃー<br />
                        いぽた
                    </p>
                </div>
            </div>
        `)
    }
</script>
